<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·¥æ—¶è®°å½•åŠ©æ‰‹</title>
    
    <!-- PWAé…ç½® -->
    <meta name="theme-color" content="#4285f4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å·¥æ—¶è®°å½•">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: #ffffff;
            color: #333333;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        /* æ‰£å­APPæç¤º - ç§»åˆ°å³ä¸Šè§’ */
        .coze-hint {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(66, 133, 244, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .coze-hint:hover {
            background: rgba(66, 133, 244, 1);
            transform: scale(1.05);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .month-btn {
            background: #f0f0f0;
            border: none;
            padding: 10px 20px;
            font-size: 24px;
            border-radius: 8px;
            cursor: pointer;
            color: #333;
        }

        .month-btn:active {
            background: #e0e0e0;
        }

        .current-month {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 30px;
        }

        .weekday {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #666;
            padding: 10px 0;
        }

        .day {
            text-align: center;
            padding: 10px 5px;
            font-size: 24px;
            font-weight: bold;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .day .day-number {
            font-size: 24px;
        }

        .day .day-hours {
            font-size: 12px;
            margin-top: 4px;
            color: #2196F3;
            font-weight: normal;
        }

        .day:active {
            background: #f5f5f5;
        }

        .day.has-record {
            background: #e3f2fd;
            border-color: #2196F3;
            color: #1976D2;
        }

        .day.today {
            border-color: #FF5722;
            border-width: 3px;
        }

        .day.other-month {
            color: #ccc;
            background: #f9f9f9;
        }

        .day.empty {
            border: none;
            cursor: default;
        }

        .summary {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-title {
            font-size: 20px;
            color: #666;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 42px;
            font-weight: bold;
            color: #2196F3;
        }

        .filter-section {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .date-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .date-input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .date-label {
            font-size: 16px;
            color: #666;
        }

        .date-input {
            width: 100%;
            padding: 12px;
            font-size: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            color: #333;
        }

        .filter-btn {
            width: 100%;
            padding: 15px;
            font-size: 22px;
            font-weight: bold;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .filter-btn:active {
            background: #1976D2;
        }

        .clear-filter {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            width: 100%;
        }

        /* è®°å½•å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 0;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 16px;
            width: 95%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
        }

        .modal-header {
            margin-bottom: 20px;
            position: relative;
        }

        .modal-title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .modal-date {
            font-size: 20px;
            color: #666;
        }

        .back-btn {
            position: absolute;
            left: 0;
            top: 0;
            background: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }

        .day-summary {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .day-summary-title {
            font-size: 18px;
            font-weight: bold;
            color: #1976D2;
            margin-bottom: 8px;
        }

        .day-summary-value {
            font-size: 36px;
            font-weight: bold;
            color: #1976D2;
        }

        /* æ—¶é—´æ®µé€‰æ‹©å™¨æ ·å¼ */
        .time-period-section {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .time-period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .time-period-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            text-align: left;
        }

        .no-work-btn {
            background: #9e9e9e;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .no-work-btn.active {
            background: #757575;
        }

        .time-period-range {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
            text-align: left;
        }

        /* æ»šè½®é€‰æ‹©å™¨å®¹å™¨ */
        .picker-container {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .picker {
            flex: 1;
            min-width: 60px;
        }

        .picker-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            text-align: center;
        }

        /* æ»šè½®æ ·å¼ */
        .picker-scroll {
            height: 150px;
            overflow: hidden;
            position: relative;
            background: #fff;
            border: 2px solid #2196F3;
            border-radius: 8px;
        }

        .picker-wheel {
            height: 100%;
            overflow-y: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            padding-top: 55px;
            padding-bottom: 55px;
        }

        .picker-wheel::-webkit-scrollbar {
            width: 6px;
        }

        .picker-wheel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }

        .picker-wheel::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 8px;
        }

        .picker-item {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #999;
            cursor: pointer;
            transition: all 0.2s;
        }

        .picker-item:hover {
            background: #e8f0fe;
            color: #4285f4;
        }

        .picker-item.selected {
            color: #1976D2;
            font-size: 18px;
            font-weight: bold;
            background: #e3f2fd;
        }

        .picker-separator {
            font-size: 18px;
            font-weight: bold;
            color: #666;
            align-self: center;
        }

        .time-period-result {
            font-size: 18px;
            color: #2196F3;
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
        }

        .error-message {
            color: #f44336;
            font-size: 15px;
            font-weight: bold;
            text-align: right;
            margin-top: 5px;
            min-height: 22px;
        }

        /* æ—¶é—´æ®µæŒ‰é’®ç»„ */
        .period-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .period-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .period-btn-confirm {
            background: #4caf50;
            color: white;
        }

        .period-btn-confirm:hover {
            background: #45a049;
        }

        .period-btn-reset {
            background: #f44336;
            color: white;
        }

        .period-btn-reset:hover {
            background: #da190b;
        }

        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            display: none;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 20px;
            z-index: 2000;
        }

        .toast.show {
            display: block;
            animation: fadeInOut 2s ease-in-out;
        }

        .toast.error {
            background: #f44336;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            20% { opacity: 1; transform: translate(-50%, 0); }
            80% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        /* é€‰ä¸­é«˜äº®æ¡ */
        .picker-highlight {
            position: absolute;
            top: 55px;
            left: 0;
            right: 0;
            height: 40px;
            background: rgba(33, 150, 243, 0.1);
            pointer-events: none;
            border-top: 1px solid #2196F3;
            border-bottom: 1px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="month-selector">
            <button class="month-btn" onclick="changeMonth(-1)">â—€</button>
            <div class="current-month" id="currentMonth">2026å¹´2æœˆ</div>
            <button class="month-btn" onclick="changeMonth(1)">â–¶</button>
        </div>
    </div>

    <div class="calendar" id="calendar">
        <div class="weekday">æ—¥</div>
        <div class="weekday">ä¸€</div>
        <div class="weekday">äºŒ</div>
        <div class="weekday">ä¸‰</div>
        <div class="weekday">å››</div>
        <div class="weekday">äº”</div>
        <div class="weekday">å…­</div>
    </div>

    <div class="summary">
        <div class="summary-title" id="summaryTitle">æœ¬æœˆç´¯è®¡</div>
        <div class="summary-value" id="summaryValue">0 å·¥æ—¶</div>
    </div>

    <div class="filter-section">
        <div class="filter-title">ğŸ“… ç»Ÿè®¡ç­›é€‰</div>
        <div class="date-row">
            <div class="date-input-wrapper">
                <label class="date-label">å¼€å§‹æ—¥æœŸ</label>
                <input type="date" class="date-input" id="startDate">
            </div>
            <div class="date-input-wrapper">
                <label class="date-label">ç»“æŸæ—¥æœŸ</label>
                <input type="date" class="date-input" id="endDate">
            </div>
        </div>
        <button class="filter-btn" onclick="filterRecords()">è®¡ç®—å·¥æ—¶</button>
        <button class="clear-filter" onclick="clearFilter()">æ˜¾ç¤ºæœ¬æœˆ</button>
    </div>

    <!-- æ—¥æœŸè¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="recordModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="back-btn" onclick="closeModal()">â† è¿”å›</button>
                <div class="modal-title">å·¥æ—¶è®°å½•</div>
                <div class="modal-date" id="modalDate"></div>
            </div>

            <div class="day-summary">
                <div class="day-summary-title">å½“æ—¥æ€»å·¥æ—¶</div>
                <div class="day-summary-value" id="daySummaryValue">0 å·¥æ—¶</div>
            </div>

            <!-- ä¸Šåˆæ—¶æ®µ -->
            <div class="time-period-section">
                <div class="time-period-header">
                    <div class="time-period-title">â˜€ï¸ ä¸Šåˆæ—¶æ®µ</div>
                    <button class="no-work-btn" id="morningNoWorkBtn" onclick="toggleNoWork('morning')">æ— å·¥ä½œ</button>
                </div>
                <div class="time-period-range">èŒƒå›´ï¼š00:00 - 12:00</div>
                <div class="picker-container" id="morningPickerContainer">
                    <div class="picker">
                        <div class="picker-label">å¼€å§‹å°æ—¶</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="morningStartHourWheel"></div>
                        </div>
                    </div>
                    <div class="picker">
                        <div class="picker-label">å¼€å§‹åˆ†é’Ÿ</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="morningStartMinWheel"></div>
                        </div>
                    </div>
                    <span class="picker-separator">è‡³</span>
                    <div class="picker">
                        <div class="picker-label">ç»“æŸå°æ—¶</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="morningEndHourWheel"></div>
                        </div>
                    </div>
                    <div class="picker">
                        <div class="picker-label">ç»“æŸåˆ†é’Ÿ</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="morningEndMinWheel"></div>
                        </div>
                    </div>
                </div>
                <div class="time-period-result" id="morningResult">0 å·¥æ—¶</div>
                <div class="error-message" id="morningError"></div>
                <div class="period-buttons" id="morningButtons">
                    <button class="period-btn period-btn-confirm" onclick="confirmMorning()">ç¡®å®š</button>
                    <button class="period-btn period-btn-reset" onclick="resetMorning()">é‡ç½®</button>
                </div>
            </div>

            <!-- ä¸‹åˆæ—¶æ®µ -->
            <div class="time-period-section">
                <div class="time-period-header">
                    <div class="time-period-title">ğŸŒ¤ï¸ ä¸‹åˆæ—¶æ®µ</div>
                    <button class="no-work-btn" id="afternoonNoWorkBtn" onclick="toggleNoWork('afternoon')">æ— å·¥ä½œ</button>
                </div>
                <div class="time-period-range">èŒƒå›´ï¼š12:00 - 24:00</div>
                <div class="picker-container" id="afternoonPickerContainer">
                    <div class="picker">
                        <div class="picker-label">å¼€å§‹å°æ—¶</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="afternoonStartHourWheel"></div>
                        </div>
                    </div>
                    <div class="picker">
                        <div class="picker-label">å¼€å§‹åˆ†é’Ÿ</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="afternoonStartMinWheel"></div>
                        </div>
                    </div>
                    <span class="picker-separator">è‡³</span>
                    <div class="picker">
                        <div class="picker-label">ç»“æŸå°æ—¶</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="afternoonEndHourWheel"></div>
                        </div>
                    </div>
                    <div class="picker">
                        <div class="picker-label">ç»“æŸåˆ†é’Ÿ</div>
                        <div class="picker-scroll">
                            <div class="picker-highlight"></div>
                            <div class="picker-wheel" id="afternoonEndMinWheel"></div>
                        </div>
                    </div>
                </div>
                <div class="time-period-result" id="afternoonResult">0 å·¥æ—¶</div>
                <div class="error-message" id="afternoonError"></div>
                <div class="period-buttons" id="afternoonButtons">
                    <button class="period-btn period-btn-confirm" onclick="confirmAfternoon()">ç¡®å®š</button>
                    <button class="period-btn period-btn-reset" onclick="resetAfternoon()">é‡ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast">ä¿å­˜æˆåŠŸï¼</div>

    <script>
        // æ•°æ®å­˜å‚¨
        let workRecords = JSON.parse(localStorage.getItem('workRecords') || '{}');
        let currentDate = new Date();
        let selectedDate = null;
        let filterMode = false;
        let filterStart = null;
        let filterEnd = null;

        // æ—¶é—´é€‰æ‹©å™¨çŠ¶æ€
        let morningStartHour = 8;
        let morningStartMin = 0;
        let morningEndHour = 12;
        let morningEndMin = 0;
        let morningConfirmed = false;
        let morningNoWork = false;

        let afternoonStartHour = 13;
        let afternoonStartMin = 0;
        let afternoonEndHour = 18;
        let afternoonEndMin = 0;
        let afternoonConfirmed = false;
        let afternoonNoWork = false;

        // ä¸Šåˆå°æ—¶ï¼š0-11ï¼ˆ12ä¸ªé€‰é¡¹ï¼‰
        const morningHours = [];
        for (let h = 0; h < 12; h++) {
            morningHours.push(h);
        }

        // ä¸‹åˆå°æ—¶ï¼š12-23ï¼ˆ12ä¸ªé€‰é¡¹ï¼‰
        const afternoonHours = [];
        for (let h = 12; h < 24; h++) {
            afternoonHours.push(h);
        }

        // åˆ†é’Ÿï¼š0-59ï¼ˆ60ä¸ªé€‰é¡¹ï¼‰
        const minutes = [];
        for (let m = 0; m < 60; m++) {
            minutes.push(m);
        }

        // åˆå§‹åŒ–æ»šè½®é€‰æ‹©å™¨
        function initPicker(wheelId, values, onSelect) {
            const wheel = document.getElementById(wheelId);
            wheel.innerHTML = '';
            
            values.forEach((value, index) => {
                const item = document.createElement('div');
                item.className = 'picker-item';
                item.textContent = String(value).padStart(2, '0');
                item.dataset.value = value;
                item.dataset.index = index;
                item.onclick = () => {
                    // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
                    wheel.querySelectorAll('.picker-item').forEach(el => el.classList.remove('selected'));
                    item.classList.add('selected');
                    // æ»šåŠ¨åˆ°é€‰ä¸­ä½ç½®ï¼ˆè‡ªåŠ¨å¯¹é½ï¼‰
                    item.scrollIntoView({ block: 'center', behavior: 'smooth' });
                    onSelect(value);
                };
                wheel.appendChild(item);
            });

            // æ·»åŠ æ»šåŠ¨ç›‘å¬ï¼Œå®ç°è‡ªåŠ¨å¸é™„å¯¹é½
            let scrollTimeout;
            wheel.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    const scrollPosition = wheel.scrollTop;
                    const itemHeight = 40;
                    const selectedIndex = Math.round(scrollPosition / itemHeight);
                    
                    // è®¡ç®—åº”è¯¥æ»šåŠ¨åˆ°çš„ç²¾ç¡®ä½ç½®ï¼ˆè‡ªåŠ¨å¯¹é½ï¼‰
                    const targetScrollTop = selectedIndex * itemHeight;
                    
                    // å¹³æ»‘æ»šåŠ¨åˆ°å¯¹é½ä½ç½®
                    wheel.scrollTo({
                        top: targetScrollTop,
                        behavior: 'smooth'
                    });
                    
                    const items = wheel.querySelectorAll('.picker-item');
                    items.forEach((item, index) => {
                        if (index === selectedIndex && index < items.length) {
                            item.classList.add('selected');
                            if (item.dataset.value !== undefined) {
                                onSelect(parseInt(item.dataset.value));
                            }
                        } else {
                            item.classList.remove('selected');
                        }
                    });
                }, 150);
            });
        }

        // è®¾ç½®æ»šè½®é€‰ä¸­é¡¹
        function setPickerSelected(wheelId, value) {
            const wheel = document.getElementById(wheelId);
            const items = wheel.querySelectorAll('.picker-item');
            items.forEach(item => {
                if (parseInt(item.dataset.value) === value) {
                    item.classList.add('selected');
                    item.scrollIntoView({ block: 'center', behavior: 'smooth' });
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ä¸Šåˆæ»šè½®
            initPicker('morningStartHourWheel', morningHours, (value) => {
                morningStartHour = value;
                morningConfirmed = false;
                updateMorningResult();
            });
            initPicker('morningStartMinWheel', minutes, (value) => {
                morningStartMin = value;
                morningConfirmed = false;
                updateMorningResult();
            });
            initPicker('morningEndHourWheel', morningHours, (value) => {
                morningEndHour = value;
                morningConfirmed = false;
                updateMorningResult();
            });
            initPicker('morningEndMinWheel', minutes, (value) => {
                morningEndMin = value;
                morningConfirmed = false;
                updateMorningResult();
            });
            
            // åˆå§‹åŒ–ä¸‹åˆæ»šè½®
            initPicker('afternoonStartHourWheel', afternoonHours, (value) => {
                afternoonStartHour = value;
                afternoonConfirmed = false;
                updateAfternoonResult();
            });
            initPicker('afternoonStartMinWheel', minutes, (value) => {
                afternoonStartMin = value;
                afternoonConfirmed = false;
                updateAfternoonResult();
            });
            initPicker('afternoonEndHourWheel', afternoonHours, (value) => {
                afternoonEndHour = value;
                afternoonConfirmed = false;
                updateAfternoonResult();
            });
            initPicker('afternoonEndMinWheel', minutes, (value) => {
                afternoonEndMin = value;
                afternoonConfirmed = false;
                updateAfternoonResult();
            });
            
            renderCalendar();
            updateSummary();
            
            // è®¾ç½®ä»Šå¤©çš„æ—¥æœŸä½œä¸ºç­›é€‰é»˜è®¤å€¼
            const today = new Date();
            const todayStr = formatDate(today);
            document.getElementById('startDate').value = getMonthStart(today);
            document.getElementById('endDate').value = todayStr;
        });

        // åˆ‡æ¢"æ— å·¥ä½œ"çŠ¶æ€
        function toggleNoWork(period) {
            if (period === 'morning') {
                morningNoWork = !morningNoWork;
                const btn = document.getElementById('morningNoWorkBtn');
                const pickerContainer = document.getElementById('morningPickerContainer');
                const buttons = document.getElementById('morningButtons');
                
                if (morningNoWork) {
                    btn.classList.add('active');
                    btn.textContent = 'å·²æ— å·¥ä½œ';
                    pickerContainer.style.display = 'none';
                    buttons.style.display = 'none';
                    document.getElementById('morningResult').textContent = '0 å·¥æ—¶';
                    document.getElementById('morningError').textContent = '';
                    // ç«‹å³æ›´æ–°æ€»å·¥æ—¶
                    updateDayTotal();
                    // ä¿å­˜æ— å·¥ä½œçŠ¶æ€
                    saveMorningNoWork();
                } else {
                    btn.classList.remove('active');
                    btn.textContent = 'æ— å·¥ä½œ';
                    pickerContainer.style.display = 'flex';
                    buttons.style.display = 'flex';
                    morningNoWork = false;
                    // æ¢å¤æ—¶é—´é€‰æ‹©
                    resetMorning();
                }
            } else {
                afternoonNoWork = !afternoonNoWork;
                const btn = document.getElementById('afternoonNoWorkBtn');
                const pickerContainer = document.getElementById('afternoonPickerContainer');
                const buttons = document.getElementById('afternoonButtons');
                
                if (afternoonNoWork) {
                    btn.classList.add('active');
                    btn.textContent = 'å·²æ— å·¥ä½œ';
                    pickerContainer.style.display = 'none';
                    buttons.style.display = 'none';
                    document.getElementById('afternoonResult').textContent = '0 å·¥æ—¶';
                    document.getElementById('afternoonError').textContent = '';
                    // ç«‹å³æ›´æ–°æ€»å·¥æ—¶
                    updateDayTotal();
                    // ä¿å­˜æ— å·¥ä½œçŠ¶æ€
                    saveAfternoonNoWork();
                } else {
                    btn.classList.remove('active');
                    btn.textContent = 'æ— å·¥ä½œ';
                    pickerContainer.style.display = 'flex';
                    buttons.style.display = 'flex';
                    afternoonNoWork = false;
                    // æ¢å¤æ—¶é—´é€‰æ‹©
                    resetAfternoon();
                }
            }
        }

        // ä¿å­˜ä¸Šåˆæ— å·¥ä½œçŠ¶æ€
        function saveMorningNoWork() {
            if (!workRecords[selectedDate]) {
                workRecords[selectedDate] = {};
            }
            workRecords[selectedDate].morningNoWork = true;
            workRecords[selectedDate].morningHours = 0;
            workRecords[selectedDate].morningConfirmed = true;
            saveData();
            renderCalendar();
            updateSummary();
        }

        // ä¿å­˜ä¸‹åˆæ— å·¥ä½œçŠ¶æ€
        function saveAfternoonNoWork() {
            if (!workRecords[selectedDate]) {
                workRecords[selectedDate] = {};
            }
            workRecords[selectedDate].afternoonNoWork = true;
            workRecords[selectedDate].afternoonHours = 0;
            workRecords[selectedDate].afternoonConfirmed = true;
            saveData();
            renderCalendar();
            updateSummary();
        }

        // ç¡®è®¤ä¸Šåˆæ—¶æ®µ
        function confirmMorning() {
            morningConfirmed = true;
            morningNoWork = false;
            saveMorningRecord();
            updateDayTotal();
            showToast('ä¸Šåˆæ—¶æ®µå·²ç¡®å®š');
        }

        // é‡ç½®ä¸Šåˆæ—¶æ®µ
        function resetMorning() {
            morningConfirmed = false;
            morningNoWork = false;
            morningStartHour = 8;
            morningStartMin = 0;
            morningEndHour = 12;
            morningEndMin = 0;
            
            // æ¸…é™¤æ— å·¥ä½œçŠ¶æ€
            const btn = document.getElementById('morningNoWorkBtn');
            btn.classList.remove('active');
            btn.textContent = 'æ— å·¥ä½œ';
            
            // æ˜¾ç¤ºé€‰æ‹©å™¨å’ŒæŒ‰é’®
            document.getElementById('morningPickerContainer').style.display = 'flex';
            document.getElementById('morningButtons').style.display = 'flex';
            
            setPickerSelected('morningStartHourWheel', 8);
            setPickerSelected('morningStartMinWheel', 0);
            setPickerSelected('morningEndHourWheel', 12);
            setPickerSelected('morningEndMinWheel', 0);
            document.getElementById('morningError').textContent = '';
            
            // é‡ç½®å·¥æ—¶æ˜¾ç¤ºä¸º0
            document.getElementById('morningResult').textContent = '0 å·¥æ—¶';
            
            updateDayTotal();
        }

        // ç¡®è®¤ä¸‹åˆæ—¶æ®µ
        function confirmAfternoon() {
            afternoonConfirmed = true;
            afternoonNoWork = false;
            saveAfternoonRecord();
            updateDayTotal();
            showToast('ä¸‹åˆæ—¶æ®µå·²ç¡®å®š');
        }

        // é‡ç½®ä¸‹åˆæ—¶æ®µ
        function resetAfternoon() {
            afternoonConfirmed = false;
            afternoonNoWork = false;
            afternoonStartHour = 13;
            afternoonStartMin = 0;
            afternoonEndHour = 18;
            afternoonEndMin = 0;
            
            // æ¸…é™¤æ— å·¥ä½œçŠ¶æ€
            const btn = document.getElementById('afternoonNoWorkBtn');
            btn.classList.remove('active');
            btn.textContent = 'æ— å·¥ä½œ';
            
            // æ˜¾ç¤ºé€‰æ‹©å™¨å’ŒæŒ‰é’®
            document.getElementById('afternoonPickerContainer').style.display = 'flex';
            document.getElementById('afternoonButtons').style.display = 'flex';
            
            setPickerSelected('afternoonStartHourWheel', 13);
            setPickerSelected('afternoonStartMinWheel', 0);
            setPickerSelected('afternoonEndHourWheel', 18);
            setPickerSelected('afternoonEndMinWheel', 0);
            document.getElementById('afternoonError').textContent = '';
            
            // é‡ç½®å·¥æ—¶æ˜¾ç¤ºä¸º0
            document.getElementById('afternoonResult').textContent = '0 å·¥æ—¶';
            
            updateDayTotal();
        }

        // è®¡ç®—å·¥æ—¶ï¼ˆå¸¦é€»è¾‘æ ¡éªŒï¼‰
        function calculateHours(startH, startM, endH, endM) {
            let startMinutes = startH * 60 + startM;
            let endMinutes = endH * 60 + endM;
            
            // é€»è¾‘æ ¡éªŒï¼šç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´
            if (endMinutes <= startMinutes) {
                return null; // è¿”å›nullè¡¨ç¤ºé€»è¾‘é”™è¯¯
            }
            
            let hours = (endMinutes - startMinutes) / 60;
            // å››èˆäº”å…¥åˆ°0.5çš„å€æ•°
            hours = Math.round(hours * 2) / 2;
            return hours;
        }

        // æ›´æ–°ä¸Šåˆç»“æœ
        function updateMorningResult() {
            // å¦‚æœæ˜¯æ— å·¥ä½œçŠ¶æ€ï¼Œä¸è®¡ç®—
            if (morningNoWork) {
                document.getElementById('morningResult').textContent = '0 å·¥æ—¶';
                updateDayTotal();
                return;
            }
            
            const hours = calculateHours(morningStartHour, morningStartMin, morningEndHour, morningEndMin);
            const errorDiv = document.getElementById('morningError');
            const resultDiv = document.getElementById('morningResult');
            
            if (hours === null) {
                errorDiv.textContent = 'ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´';
                resultDiv.textContent = '0 å·¥æ—¶';
            } else {
                errorDiv.textContent = '';
                resultDiv.textContent = hours + ' å·¥æ—¶';
            }
            
            updateDayTotal();
        }

        // æ›´æ–°ä¸‹åˆç»“æœ
        function updateAfternoonResult() {
            // å¦‚æœæ˜¯æ— å·¥ä½œçŠ¶æ€ï¼Œä¸è®¡ç®—
            if (afternoonNoWork) {
                document.getElementById('afternoonResult').textContent = '0 å·¥æ—¶';
                updateDayTotal();
                return;
            }
            
            const hours = calculateHours(afternoonStartHour, afternoonStartMin, afternoonEndHour, afternoonEndMin);
            const errorDiv = document.getElementById('afternoonError');
            const resultDiv = document.getElementById('afternoonResult');
            
            if (hours === null) {
                errorDiv.textContent = 'ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´';
                resultDiv.textContent = '0 å·¥æ—¶';
            } else {
                errorDiv.textContent = '';
                resultDiv.textContent = hours + ' å·¥æ—¶';
            }
            
            updateDayTotal();
        }

        // ä¿å­˜ä¸Šåˆè®°å½•
        function saveMorningRecord() {
            if (!workRecords[selectedDate]) {
                workRecords[selectedDate] = {};
            }
            
            const hours = calculateHours(morningStartHour, morningStartMin, morningEndHour, morningEndMin);
            
            workRecords[selectedDate].morningStartHour = morningStartHour;
            workRecords[selectedDate].morningStartMin = morningStartMin;
            workRecords[selectedDate].morningEndHour = morningEndHour;
            workRecords[selectedDate].morningEndMin = morningEndMin;
            workRecords[selectedDate].morningHours = hours || 0;
            workRecords[selectedDate].morningConfirmed = true;
            workRecords[selectedDate].morningNoWork = false;
            
            saveData();
            renderCalendar();
            updateSummary();
        }

        // ä¿å­˜ä¸‹åˆè®°å½•
        function saveAfternoonRecord() {
            if (!workRecords[selectedDate]) {
                workRecords[selectedDate] = {};
            }
            
            const hours = calculateHours(afternoonStartHour, afternoonStartMin, afternoonEndHour, afternoonEndMin);
            
            workRecords[selectedDate].afternoonStartHour = afternoonStartHour;
            workRecords[selectedDate].afternoonStartMin = afternoonStartMin;
            workRecords[selectedDate].afternoonEndHour = afternoonEndHour;
            workRecords[selectedDate].afternoonEndMin = afternoonEndMin;
            workRecords[selectedDate].afternoonHours = hours || 0;
            workRecords[selectedDate].afternoonConfirmed = true;
            workRecords[selectedDate].afternoonNoWork = false;
            
            saveData();
            renderCalendar();
            updateSummary();
        }

        // æ›´æ–°å½“æ—¥æ€»å·¥æ—¶
        function updateDayTotal() {
            let morningHours = 0;
            let afternoonHours = 0;
            
            // è®¡ç®—ä¸Šåˆå·¥æ—¶
            if (morningNoWork) {
                // æ— å·¥ä½œçŠ¶æ€ï¼Œå·¥æ—¶ä¸º0
                morningHours = 0;
            } else if (morningConfirmed) {
                // å·²ç¡®è®¤çŠ¶æ€ï¼Œä½¿ç”¨ç¡®è®¤çš„å·¥æ—¶
                const morningCalc = calculateHours(morningStartHour, morningStartMin, morningEndHour, morningEndMin);
                if (morningCalc !== null) {
                    morningHours = morningCalc;
                } else {
                    morningHours = 0;
                }
            } else {
                // æœªç¡®è®¤çŠ¶æ€ï¼Œå·¥æ—¶ä¸º0
                morningHours = 0;
            }
            
            // è®¡ç®—ä¸‹åˆå·¥æ—¶
            if (afternoonNoWork) {
                // æ— å·¥ä½œçŠ¶æ€ï¼Œå·¥æ—¶ä¸º0
                afternoonHours = 0;
            } else if (afternoonConfirmed) {
                // å·²ç¡®è®¤çŠ¶æ€ï¼Œä½¿ç”¨ç¡®è®¤çš„å·¥æ—¶
                const afternoonCalc = calculateHours(afternoonStartHour, afternoonStartMin, afternoonEndHour, afternoonEndMin);
                if (afternoonCalc !== null) {
                    afternoonHours = afternoonCalc;
                } else {
                    afternoonHours = 0;
                }
            } else {
                // æœªç¡®è®¤çŠ¶æ€ï¼Œå·¥æ—¶ä¸º0
                afternoonHours = 0;
            }
            
            const total = morningHours + afternoonHours;
            document.getElementById('daySummaryValue').textContent = total + ' å·¥æ—¶';
        }

        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // æ›´æ–°æœˆä»½æ˜¾ç¤º
            document.getElementById('currentMonth').textContent = `${year}å¹´${month + 1}æœˆ`;
            
            // æ¸…é™¤æ—§çš„æ—¥æœŸæ ¼å­ï¼ˆä¿ç•™æ˜ŸæœŸè¡¨å¤´ï¼‰
            while (calendar.children.length > 7) {
                calendar.removeChild(calendar.lastChild);
            }
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ 
            const firstDay = new Date(year, month, 1).getDay();
            
            // è·å–å½“æœˆæ€»å¤©æ•°
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // è·å–ä¸Šæœˆæ€»å¤©æ•°
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            // è·å–ä»Šå¤©çš„æ—¥æœŸ
            const today = new Date();
            const todayStr = formatDate(today);
            
            // å¡«å……ä¸Šæœˆçš„æ—¥æœŸ
            for (let i = firstDay - 1; i >= 0; i--) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day other-month';
                const dayNum = daysInPrevMonth - i;
                dayDiv.innerHTML = `<span class="day-number">${dayNum}</span>`;
                calendar.appendChild(dayDiv);
            }
            
            // å¡«å……å½“æœˆçš„æ—¥æœŸ
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                dayDiv.className = 'day';
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è®°å½•
                let dayTotal = 0;
                if (workRecords[dateStr]) {
                    let morning = workRecords[dateStr].morningHours || 0;
                    let afternoon = workRecords[dateStr].afternoonHours || 0;
                    dayTotal = morning + afternoon;
                    if (dayTotal > 0) {
                        dayDiv.classList.add('has-record');
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                if (dateStr === todayStr) {
                    dayDiv.classList.add('today');
                }

                // æ˜¾ç¤ºæ—¥æœŸå’Œå·¥æ—¶
                const hoursText = dayTotal > 0 ? `<span class="day-hours">${dayTotal}å·¥æ—¶</span>` : '';
                dayDiv.innerHTML = `<span class="day-number">${day}</span>${hoursText}`;
                
                dayDiv.onclick = () => openModal(dateStr);
                calendar.appendChild(dayDiv);
            }
            
            // å¡«å……ä¸‹æœˆçš„æ—¥æœŸï¼ˆè¡¥é½6è¡Œï¼‰
            const totalCells = firstDay + daysInMonth;
            const remainingCells = 42 - totalCells;
            
            if (remainingCells > 0 && remainingCells < 7) {
                for (let i = 1; i <= remainingCells; i++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day other-month';
                    dayDiv.innerHTML = `<span class="day-number">${i}</span>`;
                    calendar.appendChild(dayDiv);
                }
            }
        }

        // åˆ‡æ¢æœˆä»½
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
            if (!filterMode) {
                updateSummary();
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateSummary() {
            let total = 0;
            let title = 'æœ¬æœˆç´¯è®¡';
            
            if (filterMode && filterStart && filterEnd) {
                title = `ç­›é€‰æ—¥æœŸç´¯è®¡`;
                const start = new Date(filterStart);
                const end = new Date(filterEnd);
                
                for (let date in workRecords) {
                    const d = new Date(date);
                    if (d >= start && d <= end) {
                        if (workRecords[date]) {
                            let morning = workRecords[date].morningHours || 0;
                            let afternoon = workRecords[date].afternoonHours || 0;
                            total += morning + afternoon;
                        }
                    }
                }
            } else {
                // è®¡ç®—æœ¬æœˆç´¯è®¡
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                for (let date in workRecords) {
                    const d = new Date(date);
                    if (d.getFullYear() === year && d.getMonth() === month) {
                        if (workRecords[date]) {
                            let morning = workRecords[date].morningHours || 0;
                            let afternoon = workRecords[date].afternoonHours || 0;
                            total += morning + afternoon;
                        }
                    }
                }
            }
            
            // å››èˆäº”å…¥åˆ°0.5çš„å€æ•°
            total = Math.round(total * 2) / 2;
            document.getElementById('summaryTitle').textContent = title;
            document.getElementById('summaryValue').textContent = total + ' å·¥æ—¶';
        }

        // æ‰“å¼€æ—¥æœŸè¯¦æƒ…å¼¹çª—
        function openModal(dateStr) {
            selectedDate = dateStr;
            const date = new Date(dateStr);
            document.getElementById('modalDate').textContent = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            
            // åŠ è½½å·²ä¿å­˜çš„è®°å½•
            const record = workRecords[selectedDate];
            
            // ä¸Šåˆæ—¶æ®µ - é»˜è®¤0å·¥æ—¶ï¼Œæœªç¡®è®¤çŠ¶æ€
            if (record && (record.morningConfirmed || record.morningNoWork)) {
                if (record.morningNoWork) {
                    morningNoWork = true;
                    morningConfirmed = true;
                    const btn = document.getElementById('morningNoWorkBtn');
                    btn.classList.add('active');
                    btn.textContent = 'å·²æ— å·¥ä½œ';
                    document.getElementById('morningPickerContainer').style.display = 'none';
                    document.getElementById('morningButtons').style.display = 'none';
                    document.getElementById('morningResult').textContent = '0 å·¥æ—¶';
                    document.getElementById('morningError').textContent = '';
                } else if (record.morningConfirmed) {
                    morningStartHour = record.morningStartHour || 8;
                    morningStartMin = record.morningStartMin || 0;
                    morningEndHour = record.morningEndHour || 12;
                    morningEndMin = record.morningEndMin || 0;
                    morningConfirmed = true;
                    morningNoWork = false;
                    const btn = document.getElementById('morningNoWorkBtn');
                    btn.classList.remove('active');
                    btn.textContent = 'æ— å·¥ä½œ';
                    document.getElementById('morningPickerContainer').style.display = 'flex';
                    document.getElementById('morningButtons').style.display = 'flex';
                    // æ˜¾ç¤ºå·²ç¡®è®¤çš„å·¥æ—¶
                    const morningHours = calculateHours(morningStartHour, morningStartMin, morningEndHour, morningEndMin);
                    document.getElementById('morningResult').textContent = morningHours + ' å·¥æ—¶';
                }
            } else {
                // é»˜è®¤çŠ¶æ€ï¼š0å·¥æ—¶ï¼Œæœªç¡®è®¤ï¼Œæ˜¾ç¤º"å¾…é€‰æ‹©"
                morningStartHour = 8;
                morningStartMin = 0;
                morningEndHour = 12;
                morningEndMin = 0;
                morningConfirmed = false;
                morningNoWork = false;
                const btn = document.getElementById('morningNoWorkBtn');
                btn.classList.remove('active');
                btn.textContent = 'æ— å·¥ä½œ';
                document.getElementById('morningPickerContainer').style.display = 'flex';
                document.getElementById('morningButtons').style.display = 'flex';
                document.getElementById('morningResult').textContent = 'å¾…é€‰æ‹©';
            }
            
            // ä¸‹åˆæ—¶æ®µ - é»˜è®¤0å·¥æ—¶ï¼Œæœªç¡®è®¤çŠ¶æ€
            if (record && (record.afternoonConfirmed || record.afternoonNoWork)) {
                if (record.afternoonNoWork) {
                    afternoonNoWork = true;
                    afternoonConfirmed = true;
                    const btn = document.getElementById('afternoonNoWorkBtn');
                    btn.classList.add('active');
                    btn.textContent = 'å·²æ— å·¥ä½œ';
                    document.getElementById('afternoonPickerContainer').style.display = 'none';
                    document.getElementById('afternoonButtons').style.display = 'none';
                    document.getElementById('afternoonResult').textContent = '0 å·¥æ—¶';
                    document.getElementById('afternoonError').textContent = '';
                } else if (record.afternoonConfirmed) {
                    afternoonStartHour = record.afternoonStartHour || 13;
                    afternoonStartMin = record.afternoonStartMin || 0;
                    afternoonEndHour = record.afternoonEndHour || 18;
                    afternoonEndMin = record.afternoonEndMin || 0;
                    afternoonConfirmed = true;
                    afternoonNoWork = false;
                    const btn = document.getElementById('afternoonNoWorkBtn');
                    btn.classList.remove('active');
                    btn.textContent = 'æ— å·¥ä½œ';
                    document.getElementById('afternoonPickerContainer').style.display = 'flex';
                    document.getElementById('afternoonButtons').style.display = 'flex';
                    // æ˜¾ç¤ºå·²ç¡®è®¤çš„å·¥æ—¶
                    const afternoonHours = calculateHours(afternoonStartHour, afternoonStartMin, afternoonEndHour, afternoonEndMin);
                    document.getElementById('afternoonResult').textContent = afternoonHours + ' å·¥æ—¶';
                }
            } else {
                // é»˜è®¤çŠ¶æ€ï¼š0å·¥æ—¶ï¼Œæœªç¡®è®¤ï¼Œæ˜¾ç¤º"å¾…é€‰æ‹©"
                afternoonStartHour = 13;
                afternoonStartMin = 0;
                afternoonEndHour = 18;
                afternoonEndMin = 0;
                afternoonConfirmed = false;
                afternoonNoWork = false;
                const btn = document.getElementById('afternoonNoWorkBtn');
                btn.classList.remove('active');
                btn.textContent = 'æ— å·¥ä½œ';
                document.getElementById('afternoonPickerContainer').style.display = 'flex';
                document.getElementById('afternoonButtons').style.display = 'flex';
                document.getElementById('afternoonResult').textContent = 'å¾…é€‰æ‹©';
            }
            
            // è®¾ç½®æ»šè½®é€‰ä¸­å€¼ï¼ˆåªåœ¨éæ— å·¥ä½œçŠ¶æ€ä¸‹ï¼‰
            if (!morningNoWork) {
                setPickerSelected('morningStartHourWheel', morningStartHour);
                setPickerSelected('morningStartMinWheel', morningStartMin);
                setPickerSelected('morningEndHourWheel', morningEndHour);
                setPickerSelected('morningEndMinWheel', morningEndMin);
            }
            if (!afternoonNoWork) {
                setPickerSelected('afternoonStartHourWheel', afternoonStartHour);
                setPickerSelected('afternoonStartMinWheel', afternoonStartMin);
                setPickerSelected('afternoonEndHourWheel', afternoonEndHour);
                setPickerSelected('afternoonEndMinWheel', afternoonEndMin);
            }
            
            // æ¸…ç©ºé”™è¯¯æç¤º
            document.getElementById('morningError').textContent = '';
            document.getElementById('afternoonError').textContent = '';
            
            // é‡æ–°æ›´æ–°å½“æ—¥æ€»å·¥æ—¶
            updateDayTotal();
            document.getElementById('recordModal').classList.add('show');
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('recordModal').classList.remove('show');
            selectedDate = null;
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem('workRecords', JSON.stringify(workRecords));
        }

        // ç­›é€‰è®°å½•
        function filterRecords() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                showToast('è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ', true);
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showToast('å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ', true);
                return;
            }
            
            filterMode = true;
            filterStart = startDate;
            filterEnd = endDate;
            updateSummary();
            showToast('ç­›é€‰å®Œæˆï¼');
        }

        // æ¸…é™¤ç­›é€‰
        function clearFilter() {
            filterMode = false;
            filterStart = null;
            filterEnd = null;
            document.getElementById('startDate').value = getMonthStart(currentDate);
            document.getElementById('endDate').value = formatDate(new Date());
            updateSummary();
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = isError ? 'toast error show' : 'toast show';
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // è·å–æœ¬æœˆç¬¬ä¸€å¤©
        function getMonthStart(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}-01`;
        }
    </script>
    
    <!-- PWA Service Worker æ³¨å†Œ -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>